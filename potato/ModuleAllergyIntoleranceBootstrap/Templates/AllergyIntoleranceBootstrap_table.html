<div id="AllergyIntoleranceBootstrap_table" class="table-responsive">
<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th style="width: 20%">Allergen</th>
        <th style="width: 20%">Reaction</th>
        <th style="width: 15%">Severity</th>
        <th style="width: 15%">Reaction Type</th>
        <th style="width: 15%">Onset Date</th>
        <th style="width: 15%">Recorded Date</th>
    </tr>
    </thead>
    <tbody>
    {% for allergy in allergy_list %}
        <tr style="cursor: pointer;"
            hx-get="{% url 'AllergyIntoleranceBootstrap_existing' patient.id allergy.id %}"
            hx-target="#modals-here"
            hx-trigger="click"
            data-bs-toggle="modal"
            data-bs-target="#modals-here">
            <td class="text-wrap small">
                {% if allergy.code_cc.all %}
                    {{ allergy.code_cc.first.display }}
                {% endif %}
            </td>
            <td class="text-wrap small">
                {% if allergy.reactions.all %}
                {% with reaction=allergy.reactions.first %}
                    {% if reaction.manifestations.all %}
                        {% if reaction.manifestations.first.manifestation_cc.all %}
                            {{ reaction.manifestations.first.manifestation_cc.first.display }}
                        {% endif %}
                    {% endif %}
                {% endwith %}
                {% endif %}
            </td>
            <td class="text-wrap small">
                {% if allergy.reactions.all %}
                {% with reaction=allergy.reactions.first %}
                    {% if reaction.severity %}
                    {{ reaction.severity.display }}
                    {% endif %}
                {% endwith %}
                {% endif %}
            </td>
            <td class="text-wrap small">
                {% if allergy.type_cc.all %}
                {{ allergy.type_cc.first.display }}
                {% endif %}
            </td>
            <td class="text-wrap small">
                {% if allergy.onset_dateTime %}
                {{ allergy.onset_dateTime|date:"Y-m-d" }}
                {% endif %}
            </td>
            <td class="text-wrap small">
                {% if allergy.recordedDate %}
                {{ allergy.recordedDate|date:"Y-m-d" }}
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</div>

<!-- Modal container -->
<div id="modals-here"
    class="modal modal-blur fade"
    style="display: none"
    aria-hidden="false"
    tabindex="-1"
    hx-trigger="hidden.bs.modal"
    hx-get="{% url 'AllergyIntoleranceBootstrap_table' patient_id=patient.id %}"
    hx-target="#AllergyIntoleranceBootstrap_table">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content"></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('modals-here');
        modal.addEventListener('hidden.bs.modal', function() {
            console.log('table modal hidden event fired');
        });
        
        // Also log htmx events
        document.body.addEventListener('htmx:beforeRequest', function(event) {
            console.log('table htmx request starting:', event.detail);
        });
        
    });
</script>


